# ğŸ¯ PROJEKT-BRIEFING: TravelTracker Pro

> **Kopiere diesen Text in jeden neuen Chat mit Claude, damit er sofort weiÃŸ, woran wir arbeiten!**

---

## ğŸ“± PROJEKT-ÃœBERSICHT

**Projektname:** TravelTracker Pro
**Typ:** Next.js Web-Anwendung mit Supabase Backend
**Zweck:** Reiseplanungs- und Ausgabenverwaltungs-App fÃ¼r Gruppen
**Status:** âœ… Authentifizierung funktioniert, Basis-Setup komplett

---

## ğŸ› ï¸ TECH STACK

- **Framework:** Next.js 14+ (App Router)
- **Sprache:** TypeScript
- **Styling:** Tailwind CSS
- **Datenbank:** Supabase (PostgreSQL)
- **Authentifizierung:** Supabase Auth (Email/Passwort)
- **Deployment:** Vercel
- **Git:** GitHub

---

## ğŸ“‚ PROJEKTSTRUKTUR

```
traveltracker-pro/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                          # Hauptseite mit Auth & Dashboard
â”‚   â”œâ”€â”€ test/
â”‚   â”‚   â””â”€â”€ page.tsx                      # Env Test-Page (fÃ¼r Debugging)
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ admin/
â”‚           â””â”€â”€ create-user/
â”‚               â””â”€â”€ route.ts              # API fÃ¼r Admin-User-Erstellung
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ supabase.ts                       # Supabase Client mit Env-Validierung
â”œâ”€â”€ .env.local                            # Environment Variables (NICHT auf GitHub!)
â”œâ”€â”€ .gitignore                            # .env.local MUSS drin sein!
â”œâ”€â”€ package.json
â”œâ”€â”€ PROJECT-BRIEFING.md                   # Diese Datei
â””â”€â”€ README.md
```

---

## ğŸ” SUPABASE KONFIGURATION

### **Aktuelles Supabase Project:**
- **Project ID:** `tpaczpfczbznmabtcpxe`
- **Project URL:** `https://tpaczpfczbznmabtcpxe.supabase.co`
- **Region:** Europe West
- **Status:** âœ… Aktiv

### **Admin User:**
- **Email:** `wyssvera6@gmail.com`
- **Password:** `Admin123!`
- **Rolle:** `admin`
- **UUID:** Wird bei Login automatisch gesetzt

### **Environment Variables:**

**Lokal (`.env.local`):**
```env
NEXT_PUBLIC_SUPABASE_URL=https://tpaczpfczbznmabtcpxe.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRwYWN6cGZjemJ6bm1hYnRjcHhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0ODA3NDcsImV4cCI6MjA3ODA1Njc0N30.lbbMfBAdtTAbtgJa_1qKd5hz7yNqHrlINiKneCJ_t8o
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRwYWN6cGZjemJ6bm1hYnRjcHhlIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MjQ4MDc0NywiZXhwIjoyMDc4MDU2NzQ3fQ.ztEtoku8W8EyjaOj71O9yhZiFS2GLCwozbPBzfmxeWg
```

**Vercel (Production):**
- Gleiche Keys wie oben
- Gesetzt fÃ¼r: Production âœ…, Preview âœ…, Development âœ…

âš ï¸ **WICHTIG:** `.env.local` NIEMALS auf GitHub committen!

---

## ğŸ—„ï¸ DATENBANK-SCHEMA (Supabase)

### Tabellen:

#### 1. **users**
```sql
- id: UUID (Primary Key, muss mit auth.users.id Ã¼bereinstimmen!)
- email: TEXT (UNIQUE)
- name: TEXT
- role: TEXT (Werte: 'admin', 'member')
- created_at: TIMESTAMPTZ
```

#### 2. **trips**
```sql
- id: UUID (Primary Key)
- name: TEXT
- destination: TEXT
- flag: TEXT (Emoji)
- start_date: DATE
- end_date: DATE
- budget: NUMERIC
- currency: TEXT
- status: TEXT (Werte: 'active', 'archived')
- created_by: UUID (Foreign Key zu users)
- created_at: TIMESTAMPTZ
```

#### 3. **trip_members**
```sql
- id: UUID (Primary Key)
- trip_id: UUID (Foreign Key zu trips)
- user_id: UUID (Foreign Key zu users)
- role: TEXT (Werte: 'owner', 'admin', 'member')
- joined_at: TIMESTAMPTZ
- UNIQUE(trip_id, user_id)
```

#### 4. **expenses**
```sql
- id: UUID (Primary Key)
- trip_id: UUID (Foreign Key zu trips)
- user_id: UUID (Foreign Key zu users)
- category: TEXT
- description: TEXT
- amount: NUMERIC
- paid_by: TEXT
- split_between: TEXT[] (Array)
- date: DATE
- created_at: TIMESTAMPTZ
```

#### 5. **itinerary**
```sql
- id: UUID (Primary Key)
- trip_id: UUID (Foreign Key zu trips)
- day: INTEGER
- time: TEXT
- title: TEXT
- details: TEXT
- type: TEXT
- created_at: TIMESTAMPTZ
```

#### 6. **locations**
```sql
- id: UUID (Primary Key)
- trip_id: UUID (Foreign Key zu trips)
- name: TEXT
- address: TEXT
- type: TEXT (Werte: 'hotel', 'restaurant', 'activity', 'transport', 'other')
- notes: TEXT
- created_at: TIMESTAMPTZ
```

---

## ğŸ” ROW LEVEL SECURITY (RLS)

âœ… RLS ist aktiviert fÃ¼r alle Tabellen!

### **Wichtige Policies:**

**users Tabelle:**
- Jeder kann sein eigenes Profil lesen (auth.uid() = id)
- Admins kÃ¶nnen alle User sehen
- Jeder kann sein Profil updaten
- Admins kÃ¶nnen User erstellen/lÃ¶schen

**trips Tabelle:**
- User sehen nur Trips, bei denen sie Mitglied sind
- User kÃ¶nnen Trips erstellen
- Owner kÃ¶nnen Trip bearbeiten/lÃ¶schen

**Andere Tabellen:**
- Zugriff nur fÃ¼r Trip-Mitglieder
- Basierend auf trip_members ZugehÃ¶rigkeit

---

## ğŸ¯ IMPLEMENTIERTE FEATURES

### âœ… **Authentifizierung**
- Login/Logout mit Email/Passwort
- Passwort zurÃ¼cksetzen per Email
- Session-Persistenz
- Auth State Listener
- RLS-geschÃ¼tzte Datenbank

### âœ… **Admin-Panel**
- Benutzer erstellen/lÃ¶schen
- Passwort-Reset-Links versenden
- System-Ãœbersicht (Statistiken)
- User-Liste mit Rollen

### âœ… **Multi-User Support**
- User kÃ¶nnen mehreren Trips beitreten
- Rollen-basierte Berechtigungen (owner, admin, member)
- User-Tabelle sync mit auth.users

### âœ… **Environment Variable Validierung**
- FehlerprÃ¼fung beim App-Start
- Klare Fehlermeldungen wenn Keys fehlen
- Console Logs zum Debugging

---

## ğŸš§ GEPLANTE FEATURES (Noch nicht implementiert)

### ğŸŒ **Reiseverwaltung**
- Trips erstellen/bearbeiten/lÃ¶schen
- Trip-Details anzeigen
- Trip-Status verwalten
- Cover-Bilder hochladen

### ğŸ‘¥ **Team-Management**
- Mitglieder zu Trips einladen (per Email)
- Einladungen annehmen/ablehnen
- Mitglieder-Rollen Ã¤ndern
- Mitglieder entfernen

### ğŸ’° **Ausgabenverwaltung**
- Ausgaben erfassen
- Kategorisierung
- Split-Berechnungen (wer schuldet wem)
- Abrechnungs-System
- Quittungen/Belege hochladen

### ğŸ—“ï¸ **Reiseplanung**
- Tagesplan (Itinerary) erstellen
- AktivitÃ¤ten hinzufÃ¼gen
- Zeitplan verwalten
- Notizen zu AktivitÃ¤ten

### ğŸ’ **Packliste**
- Items zur Packliste hinzufÃ¼gen
- Kategorien (Kleidung, Elektronik, Dokumente)
- Abhaken-Funktion
- "Essential" Items markieren

### ğŸ—ºï¸ **Karten-Integration**
- Locations auf Karte anzeigen
- Geocoding (Adresse â†’ Koordinaten)
- Route planen
- Locations zu AktivitÃ¤ten verknÃ¼pfen

---

## ğŸ”§ ENTWICKLUNGS-WORKFLOW

### **Lokale Entwicklung:**

```bash
# Dependencies installieren
npm install

# Dev Server starten
npm run dev

# App Ã¶ffnen: http://localhost:3000
```

### **Deployment zu Vercel:**

```bash
# Ã„nderungen committen
git add .
git commit -m "Beschreibung der Ã„nderung"

# Zu GitHub pushen (triggert automatisch Vercel Deploy)
git push origin main

# Deploy dauert 1-2 Minuten
# Check: Vercel Dashboard â†’ Deployments
```

### **Env Vars Ã¤ndern:**

1. Vercel Dashboard â†’ Settings â†’ Environment Variables
2. Variable bearbeiten
3. FÃ¼r ALLE Environments aktivieren (Production, Preview, Development)
4. Redeploy triggern (Deployments â†’ ... â†’ Redeploy)

---

## ğŸ› HÃ„UFIGE PROBLEME & LÃ–SUNGEN

### **Problem: "supabaseKey is required" Fehler**

**Ursache:** Environment Variables nicht in Vercel gesetzt oder alter Build-Cache

**LÃ¶sung:**
1. Vercel â†’ Settings â†’ Environment Variables prÃ¼fen
2. Alle 3 Keys fÃ¼r ALLE Environments setzen
3. Redeploy triggern
4. Hard Refresh im Browser (CTRL+SHIFT+R)

---

### **Problem: "Database error granting user" beim Login**

**Ursache:** User existiert in `auth.users` aber nicht in `users` Tabelle, oder UUIDs stimmen nicht Ã¼berein

**LÃ¶sung:**
```sql
-- 1. PrÃ¼fe ob IDs Ã¼bereinstimmen
SELECT 
  auth.id as auth_id,
  users.id as users_id,
  auth.email
FROM auth.users auth
LEFT JOIN users ON users.id = auth.id
WHERE auth.email = 'EMAIL@HIER.COM';

-- 2. Wenn users_id NULL: User in users Tabelle anlegen
INSERT INTO users (id, email, name, role)
VALUES (
  'UUID-VON-AUTH-USERS',
  'EMAIL@HIER.COM',
  'Name',
  'admin'
);
```

---

### **Problem: Login funktioniert lokal aber nicht auf Vercel**

**Ursache:** Environment Variables nur lokal in `.env.local`, aber nicht in Vercel gesetzt

**LÃ¶sung:** Environment Variables auch in Vercel setzen (siehe oben)

---

### **Problem: Build schlÃ¤gt fehl mit TypeScript Fehler**

**Ursache:** Oft fehlende Return-Types oder Type-Errors

**LÃ¶sung:**
```bash
# TypeScript prÃ¼fen
npx tsc --noEmit

# Fehler beheben, dann:
git add .
git commit -m "Fix TypeScript errors"
git push
```

---

### **Problem: ".env.local" auf GitHub committed**

**KRITISCH!** Sofort handeln:

1. **Service Key neu generieren** in Supabase Dashboard
2. **Aus Git entfernen:**
   ```bash
   git rm --cached .env.local
   echo ".env.local" >> .gitignore
   git add .gitignore
   git commit -m "Remove .env.local from git"
   git push
   ```
3. **GitHub Security Alert schlieÃŸen** (als "Revoked")
4. **Neue Keys in Vercel setzen**

---

## ğŸ“ WICHTIGE HINWEISE FÃœR NEUE CHATS

### **Wenn du Hilfe bei diesem Projekt brauchst, teile Claude:**

1. **Diese PROJECT-BRIEFING.md Datei** (komplett kopieren)
2. **Was du tun mÃ¶chtest:**
   - Welches Feature implementieren?
   - Welches Problem lÃ¶sen?
3. **Relevante Dateien hochladen:**
   - `app/page.tsx` (fÃ¼r UI-Ã„nderungen)
   - `lib/supabase.ts` (fÃ¼r Datenbankprobleme)
   - Screenshots von Fehlermeldungen
4. **Aktueller Kontext:**
   - Lokal oder auf Vercel?
   - Welche Fehlermeldung?
   - Was hast du bereits versucht?

### **Beispiel fÃ¼r einen guten Chat-Start:**

```
Ich arbeite an TravelTracker Pro.

[Kopiere PROJECT-BRIEFING.md hier rein]

Ich mÃ¶chte: Die Trips-Verwaltung implementieren, sodass User neue Reisen erstellen kÃ¶nnen.

Aktueller Stand: Authentifizierung funktioniert, Admin-Panel ist da.

Frage: Wie erstelle ich das UI fÃ¼r "Neuen Trip anlegen"?
```

---

## ğŸ¯ NÃ„CHSTE SCHRITTE

**PrioritÃ¤t 1: Trips-Verwaltung**
- [ ] UI fÃ¼r "Neuen Trip erstellen"
- [ ] Trip-Liste anzeigen
- [ ] Trip auswÃ¤hlen
- [ ] Trip-Details bearbeiten

**PrioritÃ¤t 2: Team-Management**
- [ ] Mitglieder per Email einladen
- [ ] Einladungs-System
- [ ] Mitglieder-Liste anzeigen

**PrioritÃ¤t 3: Ausgaben**
- [ ] Ausgaben erfassen
- [ ] Split-Logik implementieren
- [ ] Abrechnungs-Ãœbersicht

---

## ğŸ”— WICHTIGE LINKS

- **GitHub Repo:** https://github.com/verawyss/TravelTrackerApp
- **Vercel Deploy:** https://travel-tracker-9kcnnugqp-veras-projects-6736a844.vercel.app/
- **Supabase Dashboard:** https://supabase.com/dashboard/project/tpaczpfczbznmabtcpxe
- **Env Test Page:** https://travel-tracker-9kcnnugqp-veras-projects-6736a844.vercel.app/test

---

## ğŸ“š NÃœTZLICHE BEFEHLE

```bash
# Development
npm run dev                    # Lokalen Server starten
npm run build                  # Production Build erstellen
npm install <package>          # Package installieren

# Git
git status                     # Ã„nderungen anzeigen
git add .                      # Alle Ã„nderungen stagen
git commit -m "message"        # Committen
git push origin main           # Zu GitHub pushen

# TypeScript
npx tsc --noEmit              # Type-Check ohne Build

# Supabase SQL ausfÃ¼hren
# â†’ Dashboard â†’ SQL Editor â†’ New query
```

---

## âœ… CHECKLISTE FÃœR NEUE FEATURE-ENTWICKLUNG

- [ ] Feature-Beschreibung klar definiert
- [ ] Betroffene Dateien identifiziert
- [ ] Datenbank-Schema (falls nÃ¶tig) geplant
- [ ] UI-Mockup/Skizze (optional)
- [ ] Branch erstellen (optional): `git checkout -b feature-name`
- [ ] Code schreiben
- [ ] Lokal testen
- [ ] Committen & Pushen
- [ ] Auf Vercel testen
- [ ] Dokumentation updaten

---

## ğŸ“ GELERNTES AUS DER ENTWICKLUNG

### **Authentifizierung:**
- UUIDs in `users.id` MÃœSSEN identisch mit `auth.users.id` sein
- RLS Policies brauchen Zeit zum "Einrasten" nach dem Login
- Auth State Listener ist besser als manuelle Session-Checks

### **Environment Variables:**
- `.env.local` NIE auf GitHub!
- Vercel braucht Variables fÃ¼r ALLE Environments (Prod, Preview, Dev)
- Nach Env-Ã„nderung immer Redeploy
- Validierung im Code spart Debugging-Zeit

### **Vercel Deployment:**
- Build-Cache kann alte Fehler verschleiern â†’ "Skip cache" beim Redeploy
- Hard Refresh im Browser nÃ¶tig nach Deploy
- Build Logs sind dein Freund!

### **Supabase:**
- RLS Policies kÃ¶nnen tricky sein â†’ im Zweifelsfall temporÃ¤r deaktivieren zum Testen
- Service Role Key NUR server-side verwenden
- SQL Editor ist super zum Debuggen

---

**Letzte Aktualisierung:** 07. November 2025
**Version:** 3.0 (Nach erfolgreichem Auth-Setup)
**Status:** âœ… Production Ready (Basis-Features)

---

**Viel Erfolg mit deinem Projekt! ğŸš€**

Du hast es geschafft! Die App lÃ¤uft und ist bereit fÃ¼r weitere Features! ğŸ‰
